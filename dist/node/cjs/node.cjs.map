{
  "version": 3,
  "sources": ["..\\..\\..\\src\\node.ts", "..\\..\\..\\src\\shared.ts"],
  "sourcesContent": [
    "import { inspect, type InspectOptions } from \"node:util\";\r\nimport { open, writeFile, type FileHandle } from \"node:fs/promises\";\r\nimport type { Logger } from \"./bookkeeper.ts\";\r\nimport type {\r\n  ConsoleLogType,\r\n  DataMapper,\r\n  Log,\r\n  LoggerInterfaceOptions,\r\n  LogWriter,\r\n} from \"./types/bookkeeper.ts\";\r\nimport { consoleLogTypes, formatLog } from \"./shared.ts\";\r\n\r\nconst _dataMapper = (logger: Logger, inspectOptions: InspectOptions, item: unknown) => {\r\n  if (typeof item === \"string\") return item;\r\n  return inspect(item, { ...inspectOptions, colors: false });\r\n};\r\n\r\nconst createConsoleWriter = (\r\n  options: LoggerInterfaceOptions & { inspectOptions?: InspectOptions },\r\n): LogWriter => {\r\n  const template = options.template ?? \"{{processed_data}}\";\r\n  const inspectOptions = Object.assign({}, options.inspectOptions ?? {}, { colors: true });\r\n  const dataMapper: DataMapper = (logger, item) => _dataMapper(logger, inspectOptions, item);\r\n\r\n  options.clearPreviousLogs && console.clear();\r\n\r\n  return (_logger, log) => {\r\n    if (consoleLogTypes.has(log.type as ConsoleLogType)) {\r\n      console[log.type as ConsoleLogType](formatLog(_logger, log, dataMapper, template));\r\n    } else console.log(formatLog(_logger, log, dataMapper, template));\r\n  };\r\n};\r\n\r\nconst createLogFileWriter = async (\r\n  filename: string,\r\n  options: LoggerInterfaceOptions & { inspectOptions?: InspectOptions } = {},\r\n): Promise<LogWriter & { close: () => Promise<void> }> => {\r\n  const handle: FileHandle = await open(filename, \"a\");\r\n  const logQueue: Log[] = [];\r\n\r\n  const _options = {\r\n    template: options.template ?? \"{{processed_data}}\",\r\n    clearPreviousLogs: options.clearPreviousLogs ?? false,\r\n    inspectOptions: Object.assign({}, options.inspectOptions ?? {}, { colors: false }),\r\n  };\r\n  const dataMapper: DataMapper = (logger, item) =>\r\n    _dataMapper(logger, _options.inspectOptions, item);\r\n\r\n  let writeAvailable = true;\r\n  const drainLogQueue = async (logger: Logger) => {\r\n    writeAvailable = false;\r\n    while (logQueue.length > 0) {\r\n      const log = logQueue.shift();\r\n      if (!log) continue;\r\n\r\n      await handle\r\n        .write(formatLog(logger, log, dataMapper, _options.template) + \"\\n\")\r\n        .catch((error) => {\r\n          console.error(`An error occurred while writing to the log file.`, { logger, log, error });\r\n          return null;\r\n        });\r\n    }\r\n    writeAvailable = true;\r\n  };\r\n\r\n  if (_options.clearPreviousLogs) {\r\n    await writeFile(filename, \"\").catch((error) => {\r\n      console.error(`An error occurred while clearing the log file.`, { error });\r\n    });\r\n  }\r\n\r\n  const writer: LogWriter & { close: () => Promise<void> } = (logger, log) => {\r\n    logQueue.push(log);\r\n    writeAvailable && drainLogQueue(logger);\r\n  };\r\n  writer.close = async () => await handle.close();\r\n  return writer;\r\n};\r\n\r\nexport { createConsoleWriter, createLogFileWriter };\r\n",
    "import type { Logger } from \"./bookkeeper.ts\";\r\nimport type { ConsoleLogType, DataMapper, Log } from \"./types/bookkeeper.ts\";\r\n\r\nexport const consoleLogTypes: Set<ConsoleLogType> = new Set([\"log\", \"info\", \"warn\", \"error\"]);\r\nexport const dayOfWeek: [string, string][] = [\r\n  [\"Sunday\", \"Sun\"],\r\n  [\"Monday\", \"Mon\"],\r\n  [\"Tuesday\", \"Tue\"],\r\n  [\"Wednesday\", \"Wed\"],\r\n  [\"Thursday\", \"Thu\"],\r\n  [\"Friday\", \"Fri\"],\r\n  [\"Saturday\", \"Sat\"],\r\n];\r\n\r\n// from https://github.com/natsie/broadutils\r\nconst strSubstitute = (\r\n  inputStr: string,\r\n  substitionMap: Map<string | RegExp, string> | Record<string, string>,\r\n) => {\r\n  const subPairs =\r\n    substitionMap instanceof Map ? [...substitionMap] : Object.entries(substitionMap);\r\n  return subPairs.reduce((acc, [key, value]) => acc.replaceAll(key, value), inputStr);\r\n};\r\n\r\nexport const formatLog = (\r\n  logger: Logger,\r\n  log: Log,\r\n  dataMapper: DataMapper,\r\n  template: string = \"{{processed_data}}\",\r\n): string => {\r\n  const logString = log.data.map((item) => dataMapper(logger, item)).join(\"\\n\");\r\n  const logDate = new Date(log.timestamp);\r\n  const isoString = logDate.toISOString();\r\n  const [fullDate, fullTime] = isoString.slice(0, -1).split(\"T\") as [string, string];\r\n  return strSubstitute(template, {\r\n    \"{{log_type}}\": log.type,\r\n    \"{{processed_data}}\": logString,\r\n    \"{{timestamp}}\": String(Math.floor(log.timestamp)),\r\n    \"{{timestamp_precise}}\": String(log.timestamp),\r\n    \"{{iso_date}}\": isoString,\r\n    \"{{date}}\": fullDate,\r\n    \"{{time}}\": fullTime,\r\n    \"{{JJ}}\": (dayOfWeek[logDate.getDay()] as [string, string])[0].toUpperCase(),\r\n    \"{{jj}}\": (dayOfWeek[logDate.getDay()] as [string, string])[0],\r\n    \"{{J}}\": (dayOfWeek[logDate.getDay()] as [string, string])[1].toUpperCase(),\r\n    \"{{j}}\": (dayOfWeek[logDate.getDay()] as [string, string])[1],\r\n    \"{{YYYY}}\": logDate.getFullYear().toString(),\r\n    \"{{YY}}\": logDate.getFullYear().toString().slice(-2),\r\n    \"{{MM}}\": logDate.getMonth().toString().padStart(2, \"0\"),\r\n    \"{{M}}\": logDate.getMonth().toString(),\r\n    \"{{dd}}\": logDate.getDate().toString().padStart(2, \"0\"),\r\n    \"{{HH}}\": logDate.getHours().toString().padStart(2, \"0\"),\r\n    \"{{hh}}\": (logDate.getHours() % 12).toString().padStart(2, \"0\"),\r\n    \"{{mm}}\": logDate.getMinutes().toString().padStart(2, \"0\"),\r\n    \"{{ss}}\": logDate.getSeconds().toString().padStart(2, \"0\"),\r\n    \"{{H}}\": logDate.getHours().toString(),\r\n    \"{{h}}\": (logDate.getHours() % 12).toString(),\r\n    \"{{m}}\": logDate.getMinutes().toString(),\r\n    \"{{s}}\": logDate.getSeconds().toString(),\r\n    \"{{ms++}}\": logDate.getMilliseconds().toString().padStart(3, \"0\"),\r\n    \"{{ms+}}\": logDate.getMilliseconds().toString().padStart(2, \"0\"),\r\n    \"{{ms}}\": logDate.getMilliseconds().toString(),\r\n    \"{{PP}}\": logDate.getHours() >= 12 ? \"PM\" : \"AM\",\r\n    \"{{pp}}\": logDate.getHours() >= 12 ? \"pm\" : \"am\",\r\n    \"{{P}}\": logDate.getHours() >= 12 ? \"P\" : \"M\",\r\n    \"{{p}}\": logDate.getHours() >= 12 ? \"p\" : \"m\",\r\n  });\r\n};\r\n"
  ],
  "mappings": "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",
  "debugId": "633E60A98854896464756E2164756E21",
  "names": []
}